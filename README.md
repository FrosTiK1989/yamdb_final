![example workflow](https://github.com/FrosTiK1989/yamdb_final/actions/workflows/yamdb_workflow.yml/badge.svg)

# Проект YaMDb

**Проект YaMDb собирает:**

- отзывы ***Review*** пользователей на произведения
- ***Titles*** Произведения делятся на категории:
  - "Книги"
  - "Фильмы"
  - "Музыка"
- Список категорий **"Category"** может быть расширен администратором (например, можно добавить категорию «Изобразительное искусство» или «Ювелирка»).

Сами произведения в YaMDb не хранятся, здесь нельзя посмотреть фильм или послушать музыку.

В каждой категории есть произведения: книги, фильмы или музыка. Например

- в категории «Книги» могут быть произведения «Винни-Пух и все-все-все» и «Марсианские хроники»
- в категории «Музыка» — песня «Давеча» группы «Насекомые» и вторая сюита Баха.

Произведению может быть присвоен жанр ***Genre*** из списка предустановленных:
> например, «Сказка», «Рок» или «Артхаус».

## Новые жанры может создавать только администратор

Благодарные или возмущённые пользователи оставляют к произведениям текстовые отзывы **Review** и ставят произведению оценку в диапазоне от одного до десяти (целое число); из пользовательских оценок формируется усреднённая оценка произведения — рейтинг (целое число). На одно произведение пользователь может оставить только один отзыв.

### Запуск проекта

Перед началом установки перейдите на компьютере в директорию с файлом docker-compose.yaml.

1.Развернуть проект:

```
docker-compose up -d
```

2.Сделать миграции:

```
docker-compose exec web python manage.py migrate
```

3.Создать суперпользователя:

```
docker-compose exec web python manage.py createsuperuser
```

4.Собрать статику:

```
docker-compose exec web python manage.py collectstatic --no-input
```

5.Импорт базы:

```
docker-compose exec web python manage.py loaddata fixtures.json
```

**К проекту по [ссылке](http://62.84.121.72/redoc/ "Инструкия по развертванию проекта находится ниже") подключена документация**

В ней описаны возможные запросы к API и структура ожидаемых ответов. Для каждого запроса указаны уровни прав доступа: пользовательские роли, которым разрешён запрос

## Шаблон env-файла

> DB_ENGINE - движок postgres

> DB_NAME - имя БД

> POSTGRES_USER - пользователь БД

> POSTGRES_PASSWORD - пароль БД

> DB_HOST - название сервиса (контейнера)

> DB_PORT - порт для подключения к БД

## Пользовательские роли

- Аноним — может просматривать описания произведений, читать отзывы и комментарии.
- Аутентифицированный пользователь (user) — может читать всё, как и Аноним, может публиковать отзывы и ставить оценки произведениям (фильмам/книгам/песенкам), может комментировать отзывы; может редактировать и удалять свои отзывы и комментарии, редактировать свои оценки произведений. Эта роль присваивается по умолчанию каждому новому пользователю.
- Модератор (moderator) — те же права, что и у Аутентифицированного пользователя, плюс право удалять и редактировать любые отзывы и комментарии.
- Администратор (admin) — полные права на управление всем контентом проекта. Может создавать и удалять произведения, категории и жанры. Может назначать роли пользователям.
- Суперюзер Django должен всегда обладать правами администратора, пользователя с правами admin. Даже если изменить пользовательскую роль суперюзера — это не лишит его прав администратора. Суперюзер — всегда администратор, но администратор — не обязательно суперюзер.

## Самостоятельная регистрация новых пользователей

1. Пользователь отправляет POST-запрос с параметрами email и username на эндпоинт

> Получить код подтверждения на переданный email.

> Права доступа: Доступно без токена.

> Использовать имя 'me' в качестве username запрещено.

> Поля email и username должны быть уникальными.

``
http://62.84.121.72/api/v1/auth/signup/
``
> Пример ожидаемого заполнения:

``` json
{
  "email": "string",
  "username": "string"
}
```

2.Сервис YaMDB отправляет письмо с кодом подтверждения (confirmation_code) на указанный адрес email.
3.Пользователь отправляет POST-запрос с параметрами username и confirmation_code на эндпоинт

``
http://62.84.121.72/api/v1/auth/token/
``
> Пример ожидаемого заполнения:

``` json
{
  "username": "string",
  "confirmation_code": "string"
}
```

> Удачный запрос вернется в виде:

``` json
{
  "token": "string"
}
```

> в ответе на запрос ему приходит token (JWT-токен).

В результате пользователь получает токен и может работать с API проекта, отправляя этот токен с каждым запросом.
После регистрации и получения токена пользователь может отправить PATCH-запрос на эндпоинт

``
http://62.84.121.72/api/v1/users/me/
``
> Пример ожидаемого заполнения:

``` json
{
  "username": "string",
  "email": "user@example.com",
  "first_name": "string",
  "last_name": "string",
  "bio": "string"
}
```

и заполнить поля в своём профайле (описание полей — в [документации](http://62.84.121.72/redoc/)).

## Создание пользователя администратором

- Пользователя может создать администратор — через админ-зону сайта или через POST-запрос на специальный эндпоинт

``
http://62.84.121.72/api/v1/users/
``
> Пример ожидаемого заполнения:

``` json
{
  "username": "string",
  "email": "user@example.com",
  "first_name": "string",
  "last_name": "string",
  "bio": "string",
  "role": "user"
}
```

(описание полей запроса для этого случая — в [документации](http://62.84.121.72/redoc/)).
В этот момент письмо с кодом подтверждения пользователю отправлять не нужно.

- После этого пользователь должен самостоятельно отправить свой *email* и *username* на эндпоинт

``
http://62.84.121.72/api/v1/auth/signup/
``
> Пример ожидаемого заполнения:

``` json
{
  "email": "string",
  "username": "string"
}
```

в ответ ему должно прийти письмо с кодом подтверждения.

> Пример ответа при неверном заполнении:

``` json
{
  "field_name": [
    "string"
  ]
}
```

- Далее пользователь отправляет POST-запрос с параметрами *username* и *confirmation_code* на эндпоинт

``
http://62.84.121.72/api/v1/auth/token/
``
> Пример ожидаемого заполнения:

``` json
{
  "username": "string",
  "confirmation_code": "string"
}
```

в ответе на запрос ему приходит token (JWT-токен), как и при самостоятельной регистрации.

## Проверить работоспособность сервера можете по ссылке

```
http://62.84.121.72/api/v1/
```

## Использованные технологии в проекте

- Django

- Python

- Django REST Framework

- SimpleJWT

- Docker

## Автор проекта

- Маресов Денис

Связаться со мною можете в телеграме

```
@frostik1989
```
